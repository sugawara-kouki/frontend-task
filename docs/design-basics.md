# 基本設計

## アーキテクチャの決定事項

### 1. 状態管理

**採用技術**: カスタムフック（usePages, usePageEditor）

**選定理由**:

- **シンプルさ**: 小〜中規模のアプリケーションに適した軽量な実装
- **学習コスト**: React の標準機能のみで実装可能
- **テスタビリティ**: フック単体でのユニットテストが容易
- **依存関係の最小化**: 外部ライブラリ不要（バリデーション用の Zod のみ）

**他の選択肢との比較**:

- **Redux / Zustand**: グローバル状態管理が必要になるほどの規模ではない
- **Context API**: オーバーエンジニアリングになる
- **React Query / SWR**: サーバーキャッシュの複雑な管理が不要

### 2. バリデーション

**採用技術**: Zod によるスキーマバリデーション

**選定理由**:

- **型安全性**: TypeScript との統合が優れている
- **一貫性**: フロントエンド・API レスポンスの両方で使用可能
- **開発体験**: エラーメッセージのカスタマイズが直感的
- **バンドルサイズ**: 軽量で Next.js との相性が良い

**他の選択肢との比較**:

- **Yup**: Zod の方が TypeScript の型推論が優れている
- **joi**: ブラウザ向けではなくサーバーサイド向け
- **手動バリデーション**: 保守性・拡張性に欠ける

**バリデーションルール**:

- タイトル: 1〜50 文字
- 本文: 10〜2000 文字

### 3. テストツール

**採用技術**: Jest + React Testing Library

**選定理由**:

- **公式サポート**: Next.js との公式統合（next/jest）
- **デファクトスタンダード**: React コミュニティで広く採用
- **充実したエコシステム**: プラグイン・リソースが豊富
- **TypeScript サポート**: ts-jest による型安全なテスト

**他の選択肢との比較**:

- **Vitest**: より高速だが Next.js との統合がまだ発展途上
- **Playwright / Cypress**: E2E テストには有用だが、今回はユニットテストをスコープとしたため

## コンポーネント設計

### 設計方針

**責務の分離**:

- **プレゼンテーショナルコンポーネント**: UI の描画のみを担当（components/）
- **カスタムフック**: ビジネスロジック・状態管理を担当（hooks/）
- **共通ロジック**: 型定義・バリデーション（lib/）

**コンポーネント分割の考え方**:

- **再利用性**: ボタンコンポーネントは機能別に分割（EditButton, SaveButton など）
- **単一責任**: 各コンポーネントは 1 つの明確な役割を持つ
- **テスタビリティ**: 依存関係を props で注入し、テストしやすい構造

### ディレクトリ構造

```
app/
├── layout.tsx (ルートレイアウト)
├── page.tsx (メインページ - ページ一覧とエディターを統合)
├── components/
│   ├── Sidebar/ (サイドバー - ページ一覧とナビゲーション)
│   ├── PageEditor/ (ページエディター - タイトル・本文の編集)
│   └── Button/ (再利用可能なボタンコンポーネント群)
├── hooks/
│   ├── usePages.ts (ページ一覧の状態管理・CRUD 操作)
│   └── usePageEditor.ts (個別ページ編集の状態管理・バリデーション)
└── lib/
    ├── types.ts (型定義)
    └── validation.ts (バリデーションスキーマ)
```

### 状態管理の責務分担

**usePages フック**:

- ページ一覧の取得・管理
- CRUD 操作（作成・更新・削除）
- 現在選択中のページの管理
- API 通信

**usePageEditor フック**:

- タイトル・本文の入力状態
- バリデーション実行
- エラーメッセージ管理
- 保存処理のコールバック

## テスト戦略

**ユニットテスト**:

- バリデーションロジック（`app/lib/validation.test.ts`）
  - Zod スキーマの境界値テスト
  - エラーメッセージの検証
- カスタムフック（`app/hooks/usePageEditor.test.ts`）
  - エラー状態管理
  - コールバック呼び出しの検証

### テストツール

Jest + React Testing Library

- Next.js との公式統合（next/jest）
- jsdom 環境でコンポーネントテスト
- ts-jest による TypeScript サポート
- テストコマンド: `npm test`
