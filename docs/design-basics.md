# 設計基本方針 & 実装詳細

## アーキテクチャの決定事項

### 1. 状態管理

**決定が必要な事項**: アプリケーションの状態をどう管理するか？

- 選択肢 A: React Context API（シンプル、依存なし）
- 選択肢 B: ローカルステート + localStorage（最小限のセットアップ）
- 選択肢 C: 状態管理ライブラリ（Redux、Zustand 等）

**推奨**: React Context API + localStorage による永続化

- 軽量でこの規模に適している
- 実装と保守が容易
- 追加の依存関係が不要

### 2. データ永続化

**決定が必要な事項**: ページデータをどこに保存するか？

- 選択肢 A: localStorage（クライアントサイドのみ）
- 選択肢 B: バックエンド API + データベース（サーバーセットアップが必要）
- 選択肢 C: IndexedDB（クライアントサイド、より堅牢）

**推奨**: localStorage

- シンプルな実装
- バックエンド不要
- このアプリケーションの範囲には十分

### 3. ルーティング

**決定が必要な事項**: ページナビゲーションをどう扱うか？

- 選択肢 A: URL パラメータを使ったクライアントサイドルーティング（例：`/page/[id]`）
- 選択肢 B: 状態ベースのレンダリングで単一ページ
- 選択肢 C: Next.js のダイナミックルート

**推奨**: Next.js のダイナミックルート

- 共有可能な URL でより良い UX
- ブラウザ履歴のサポート
- 後で SEO が必要になった場合にも対応可能

## UI/UX の考慮事項

### レイアウト構造

```
+------------------+------------------------+
|                  |                        |
|   サイドバー     |   メインコンテンツ     |
|                  |                        |
|  - ページ一覧    |  - タイトル入力        |
|  - 追加ボタン    |  - 本文テキストエリア  |
|  - 削除ボタン    |  - 保存ボタン          |
|                  |                        |
+------------------+------------------------+
```

### サイドバーのデザイン

- 固定幅: 250-300px
- ページが多い場合はスクロール可能
- 各ページアイテムに表示する内容：
  - ページタイトル（長すぎる場合は省略）
  - 削除ボタン（「-」）
- 「+」ボタンは下部または上部に配置
- アクティブなページをハイライト表示

### メインコンテンツエリア

- 残りのスペースに対してレスポンシブ
- タイトルと本文の明確な視覚的分離
- フォーム要素：
  - タイトル: 単一行入力
  - 本文: 複数行テキストエリア（自動リサイズまたは固定高さ）
- 保存ボタンの配置（右上または右下）
- 保存アクションの視覚的フィードバック

### バリデーションの UX

- リアルタイムバリデーションフィードバック
- エラーメッセージ：
  - 入力フィールドの下にインライン表示
  - 何が間違っているかの明確な指示
  - 両フィールドの文字数カウンター
- バリデーション失敗時は保存を防止
- 視覚的インジケーター（赤枠、エラーテキスト等）

## 機能拡張（オプション）

### 1. 自動保存

- 遅延後に変更を自動保存（例：2 秒後）
- 「保存中...」/「保存済み」のステータス表示
- データ損失を防止

### 2. ページメタデータ

- 作成タイムスタンプ
- 最終更新タイムスタンプ
- サイドバーまたはページヘッダーに表示

### 3. 検索/フィルター

- タイトルでページを検索
- サイドバーのフィルター機能
- 多数のページがある場合に便利

### 4. 確認ダイアログ

- ページ削除前の確認
- 未保存の変更がある場合の離脱警告
- 誤操作によるデータ損失を防止

### 5. 空状態の表示

- ページが存在しない場合のメッセージ
- 最初のページ作成へのガイダンス
- より良いオンボーディング体験

### 6. ページの並び替え

- ドラッグ&ドロップでページを並び替え
- 作成日、タイトル等でソート
- より良い整理機能

## 技術実装の詳細

### データモデル

```typescript
interface Page {
  id: string;
  title: string;
  body: string;
  createdAt: number;
  updatedAt: number;
}
```

### コンポーネント構造

```
app/
├── layout.tsx (ルートレイアウト)
├── page.tsx (ホーム - リダイレクトまたは最初のページを表示)
├── components/
│   ├── Sidebar.tsx
│   ├── PageList.tsx
│   ├── PageEditor.tsx
│   ├── PageItem.tsx
│   └── ConfirmDialog.tsx (オプション)
├── contexts/
│   └── PagesContext.tsx
├── hooks/
│   ├── usePages.ts
│   └── useLocalStorage.ts
└── lib/
    ├── validation.ts
    └── storage.ts
```

### テスト戦略

- **ユニットテスト**:
  - バリデーション関数
  - ストレージユーティリティ
  - カスタムフック
- **コンポーネントテスト**:
  - サイドバーのレンダリングとインタラクション
  - ページエディター機能
  - フォームバリデーション
- **統合テスト**:
  - 完全な CRUD ワークフロー
  - ページ間のナビゲーション
  - データ永続化

### テストツール

- Jest + React Testing Library（Next.js で一般的）
- または Vitest（より高速な代替）
- 重要なパスには Playwright で E2E テストを検討

## アクセシビリティの考慮事項

### キーボードナビゲーション

- すべてのインタラクティブ要素がフォーカス可能
- 論理的なタブ順序
- Enter キーで送信/保存
- Escape キーで操作をキャンセル

### ARIA ラベル

- ボタンと入力の適切なラベル
- スクリーンリーダー対応
- セマンティックな HTML 要素

### 視覚的アクセシビリティ

- 十分な色のコントラスト
- フォーカスインジケーター
- 入力と関連付けられたエラーメッセージ

## パフォーマンスの考慮事項

### 最適化戦略

- 自動保存を実装する場合はデバウンス
- 高コストな計算をメモ化
- 必要に応じてコンポーネントの遅延ロード
- 大量のページリストには仮想スクロール（ページ数が多い場合）

## ブラウザサポート

- モダンブラウザ（Chrome、Firefox、Safari、Edge）
- localStorage の可用性チェック
- 必要に応じて段階的な機能低下

## セキュリティの考慮事項

- 入力のサニタイゼーション（XSS 防止）
- localStorage からのデータを検証
- 破損したデータを適切に処理
- 機密データは保存しない（クライアントサイドのみ）
